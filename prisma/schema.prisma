generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_PRISMA_URL") // uses connection pooling
  directUrl = env("POSTGRES_URL_NON_POOLING") // uses a direct connection
}

model Media {
  id                   Int      @id @default(autoincrement())
  uri                  String   @db.VarChar(2048)
  caption              String   @db.VarChar(255)
  creatorWalletAddress String   @db.VarChar(255)
  createdAt            DateTime @default(now())
}

model User {
  id              Int      @id @default(autoincrement())
  walletAddress   String   @unique() @db.VarChar(255)
  contractAddress String   @unique() @db.VarChar(255)
  createdAt       DateTime @default(now())

  keyHolders Subscription[] @relation("creator")
  fans       Subscription[] @relation("fanUser")
}

model Subscription {
  id                     Int    @id @default(autoincrement())
  creatorContractAddress String @db.VarChar(255)
  creatorUser            User   @relation("creator",fields: [creatorContractAddress], references: [contractAddress])

  fanPublicAddress String   @db.VarChar(255)
  fanUser          User     @relation("fanUser",fields: [fanPublicAddress], references: [walletAddress])

  numKeys          Int      @default(0)
  createdAt        DateTime @default(now())

  @@unique([creatorContractAddress, fanPublicAddress])
}
